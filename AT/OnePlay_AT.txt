*** Settings ***
Suite Setup
Test Setup        Init Mobiles
Test Teardown     Close OnePlay App
Library           Mobile.py    WITH NAME    OnePlay
Library           Mobile.py    WITH NAME    QR
Library           Mobile.ADB    33336328    WITH NAME    OnePlay_adb
Library           Mobile.ADB    FA369W910426    WITH NAME    QR_adb

*** Test Cases ***
Wrong_Wifi
    Start OnePlay App
    QR_adb.shell_cmd    am start -d file:///storage/emulated/0/DCIM/100MEDIA/1_wrong_wifi.png -t image/jpg -a android.intent.action.VIEW
    Scan QR
    WaitforDialog
    Dialog Title Should Be    Wifi 设定
    Dialog Content Should Be    请连线到\nWifi: apple \n密码: banana
    BuiltIn.sleep    3s
    OnePlay.click    resourceId=tech.onetime.oneplay:id/ensBtn

Wrong_analysis
    Start OnePlay App
    QR_adb.shell_cmd    am start -d file:///storage/emulated/0/DCIM/100MEDIA/2_wrongformat.png -t image/png -a android.intent.action.VIEW
    Scan QR
    WaitforDialog
    Dialog Title Should Be    资料异常
    Dialog Content Should Be    解析资料发生异常，请更新应用程式
    BuiltIn.sleep    3s
    OnePlay.click    resourceId=tech.onetime.oneplay:id/ensBtn

Not_OnePlay_QR
    Start OnePlay App
    QR_adb.shell_cmd    am start -d file:///storage/emulated/0/DCIM/100MEDIA/3_not_oneplay.png -t image/png -a android.intent.action.VIEW
    Scan QR
    WaitforDialog
    Dialog_confirm Title Should Be    OnePlay
    Dialog_confirm Content Should Be    请读取 Micro App
    BuiltIn.sleep    3s
    OnePlay.click    resourceId=tech.onetime.oneplay:id/ensBtn

Wrong_IP
    Start OnePlay App
    QR_adb.shell_cmd    am start -d file:///storage/emulated/0/DCIM/100MEDIA/4_waiting.png -t image/png -a android.intent.action.VIEW
    Scan QR
    BuiltIn.sleep    3s
    Dialog VideoWaiting Should Be    等候读取 ...

Success_Mute_button
    Start OnePlay App
    QR_adb.shell_cmd    am start -d file:///storage/emulated/0/DCIM/100MEDIA/zoo.png -t image/png -a android.intent.action.VIEW
    Scan QR
    Playing_name Should Be    正在播放: zoo
    OnePlay.click    text=臺語
    BuiltIn.sleep    3s
    Click_Mute_Button
    BuiltIn.sleep    3s
    Click_Mute_Button
    BuiltIn.sleep    3s
    Click_Mute_Button
    BuiltIn.sleep    3s
    OnePlay.click    text=English
    BuiltIn.sleep    5s

Push Mode
    Start OnePlay App
    Click PushMode Button
    BuiltIn.sleep    5s
    Click Floating Button
    Choose exhibition    index=1
    Playing_name Should Be    正在播放: zoo
    BuiltIn.sleep    10S
    Click Floating Button
    Choose exhibition    index=2
    Playing_name Should Be    正在播放: Nemo
    BuiltIn.sleep    10S

Success_scroll_language
    Start OnePlay App
    QR_adb.shell_cmd    am start -d file:///storage/emulated/0/DCIM/100MEDIA/zoo.png -t image/png -a android.intent.action.VIEW
    Scan QR
    Playing_name Should Be    正在播放: zoo
    OnePlay.click    text=English
    BuiltIn.sleep    3s
    OnePlay.Scroll To End Vertically    scrollable=true
    OnePlay.Scroll To Beginning Vertically    scrollable=true
    OnePlay.click    text=臺語
    BuiltIn.sleep    3s

*** Keywords ***
Dialog Title Should Be
    [Arguments]    ${expect}
    ${text2}    OnePlay.Get Object    resourceId=tech.onetime.oneplay:id/connectionErrorDg_title
    ${title}    OnePlay.Get Info Of Object    ${text2}
    BuiltIn.Should Be Equal    ${title['text']}    ${expect}

Dialog Content Should Be
    [Arguments]    ${expect}
    ${text}    OnePlay.Get Object    resourceId=tech.onetime.oneplay:id/connectionErrorDg_content
    ${content}    OnePlay.Get Info Of Object    ${text}
    BuiltIn.Should Be Equal    ${content['text']}    ${expect}

Init Mobiles
    OnePlay.set_serial    33336328
    QR.set_serial    FA369W910426

Scan QR
    OnePlay.click    resourceId=tech.onetime.oneplay:id/readQr
    BuiltIn.sleep    3s

Dialog VideoWaiting Should Be
    [Arguments]    ${expect}
    ${text2}    OnePlay.Get Object    resourceId=tech.onetime.oneplay:id/playingName
    ${title}    OnePlay.Get Info Of Object    ${text2}
    BuiltIn.Should Be Equal    ${title['text']}    ${expect}

Dialog_confirm Title Should Be
    [Arguments]    ${expect}
    ${text2}    OnePlay.Get Object    resourceId=tech.onetime.oneplay:id/confirmDialog_title
    ${title}    OnePlay.Get Info Of Object    ${text2}
    BuiltIn.Should Be Equal    ${title['text']}    ${expect}

Dialog_confirm Content Should Be
    [Arguments]    ${expect}
    ${text}    OnePlay.Get Object    resourceId=tech.onetime.oneplay:id/confirmDialog_content
    ${content}    OnePlay.Get Info Of Object    ${text}
    BuiltIn.Should Be Equal    ${content['text']}    ${expect}

Playing_name Should Be
    [Arguments]    ${expect}
    ${text2}    OnePlay.Get Object    resourceId=tech.onetime.oneplay:id/playingName
    ${title}    OnePlay.Get Info Of Object    ${text2}
    BuiltIn.Should Be Equal    ${title['text']}    ${expect}

Click_Mute_Button
    OnePlay.click    resourceId=tech.onetime.oneplay:id/SelectVolumn

Start OnePlay App
    Comment    OnePlay_adb.shell_cmd    am force-stop tech.onetime.oneplay
    Comment    OnePlay_adb.shell_cmd    pm clear tech.onetime.oneplay
    OnePlay_adb.shell_cmd    am start -n tech.onetime.oneplay/.activity.starting.InitActivityV3_

Click PushMode Button
    Oneplay.click    resourceId=tech.onetime.oneplay:id/readPush

Click Floating Button
    OnePlay.click    resourceId=tech.onetime.oneplay:id/floatingActionButton

Choose exhibition
    [Arguments]    &{index}
    BuiltIn.sleep    3s
    OnePlay.click    &{index}
    BuiltIn.sleep    3s
    OnePlay.click    text=ok
    BuiltIn.sleep    3s

Close OnePlay App
    OnePlay_adb.shell_cmd    am force-stop tech.onetime.oneplay
    OnePlay_adb.shell_cmd    pm clear tech.onetime.oneplay

WaitforDialog
    BuiltIn.sleep    2s
    ${text}    OnePlay.Wait For Exists    resourceId=tech.onetime.oneplay:id/ensBtn    timeout=3000
    Run Keyword If    '${text}'=='True'    BuiltIn.sleep    2s
